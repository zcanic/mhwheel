# 猎人命运轮盘：项目介绍与设计文档

**版本:** 2.1 (分享功能增强版)
**最后更新:** 2025年8月16日

## 1. 项目概述 (Project Overview)

### 1.1. 项目简介
**猎人命运轮盘 (Hunter's Destiny Wheel)** 是一个为全球最受欢迎的共斗游戏《怪物猎人》系列玩家量身打造的网页工具。它通过随机化的方式，为玩家的每一次狩猎增添未知性、挑战性和趣味性。

### 1.2. 目标用户
本项目服务于所有《怪物猎人》玩家，无论是喜欢独自挑战高难度任务的"独狼"玩家，还是享受与朋友们并肩作战的猎人小队。

### 1.3. 核心价值
在长时间的游戏过程中，玩家往往会陷入使用"版本答案"或自己最顺手武器的惯性中，从而错失了体验其他13种同样设计精良的武器的乐趣。本项目旨在解决以下痛点：
*   **选择困难:** "今天玩什么武器？"、"下一个打什么怪？"
*   **玩法固化:** 打破玩家的舒适区，鼓励他们拿起陌生的武器，学习新的战斗方式。
*   **联机趣味:** 为朋友间的联机狩猎增加"规则"和"变数"，将简单的"开黑刷怪"变为一场充满意外和笑声的冒险。

## 2. 设计哲学 (Design Philosophy)

本项目的UI/UX设计遵循一套清晰、现代的哲学，旨在提供优雅、流畅且富有情感的交互体验。

*   **Bento Grid (便当盒) 布局:** 核心界面由数个功能独立的"盒子"组成。这种布局不仅在视觉上清晰、模块化，更重要的是它拥有天然的响应式优势。在PC端，盒子们优雅地排列成多栏网格，突显核心信息；在移动端，它们则会自动堆叠为单栏布局，保证了小屏幕下的最佳浏览体验。

*   **信息层级 (Information Hierarchy):** 通过"盒子"的大小和位置来引导用户的视觉焦点。例如，在单人模式中，轮盘占据了最大、最核心的位置；在多人模式中，玩家卡片区域则是视觉中心。

*   **优雅与空气感 (Elegance & Airiness):** 我们刻意选择了柔和、低饱和度的色板（以 `zinc` 和 `slate` 色系为基础），搭配大圆角和充足的留白（Whitespace），营造出一种不具压迫感、干净、舒适的视觉氛围。功能性的主色调（如蓝色、绿色）则克制地用在关键交互元素上，作为视觉引导。

*   **动态与反馈 (Animation & Feedback):** 我们坚信，优秀的反馈是交互的灵魂。项目中大量运用了微妙的过渡和动画效果（如按钮的脉冲、结果的弹出、挑战的滑入），并为关键操作（如开始旋转、结果揭晓）配上了精心设计的音效。这些细节共同构建了一种"有生命"的交互感。

## 3. 功能详述 (Feature Breakdown)

### 3.1. 通用功能
*   **模式切换:** 页面顶部提供"单人模式"与"多人模式"的切换按钮，允许用户在两种核心玩法间无缝切换。

### 3.2. 单人模式
为孤独的猎人提供命运的指引。
*   **命运轮盘:**
    *   一个使用HTML5 Canvas绘制的、包含14种武器的动态轮盘。
    *   点击"开始占卜"后，轮盘会以一个符合物理直觉（带有摩擦力减速）的方式旋转，指针下方的"咔哒"声与扇区切换同步，营造出真实的机械感。
*   **结果呈现:**
    *   旋转结束后，结果会以卡片的形式优雅地出现。
    *   卡片上不仅有武器名称，还有一句符合该武器气质的"风味文本"，增加了代入感。
    *   结果出现时，有25%的几率会额外出现一个"进阶挑战"，为本次狩猎增加额外的目标和难度。
*   **自定义武器池:**
    *   用户可以随时在右侧的武器池中取消勾选任何不希望出现在轮盘里的武器。
    *   轮盘会动态地根据用户的选择重绘，最少需要2种武器才能启动。
    *   提供"全选"和"全不选"按钮，方便用户快速操作。

### 3.3. 多人模式 (核心功能)
为猎人小队带来无尽的变数和乐趣。
*   **玩家管理系统:**
    *   **玩家卡片:** 界面核心是玩家卡片，用户可以通过"+ 添加玩家"按钮将玩家数量从2人动态扩展至4人。
    *   **昵称自定义:** 每个玩家卡片上的名称都是一个输入框，用户可以直接点击修改，为自己的小队成员命名。
    *   **动态移除:** 当玩家数多于2人时，每个卡片的右上角会出现"×"按钮，可以移除该玩家。
*   **武器与挑战分配:**
    *   **核心逻辑:** 点击"分配武器"后，系统会从当前激活的武器池中，为每一位玩家**不重复地**分配一种武器和一个随机的"个人挑战"。
    *   **团队挑战:** 分配结果出现时，有25%的几率会额外出现一个"团队挑战"，这个挑战需要所有玩家共同完成。
    *   **"老虎机"动画:** 为了增加悬念和仪式感，分配过程并非瞬间完成。每个玩家的武器卡片都会经历一个"老虎机"式的滚动动画，然后逐一揭晓最终结果，并伴有提示音效。
*   **"再Roll一次！" (Reroll):**
    *   结果揭晓后，如果某位玩家对自己的"命运"不满意，他有一次点击"重roll"按钮的机会。
    *   重roll时，系统会从**除自己和其他人已分配武器之外的**武器池中，重新为他选择一把武器，并刷新他的个人挑战。
*   **一键分享功能 (NEW!):**
    *   **智能分享:** 分配结果完成后，点击"📸 分享结果"按钮，系统会自动生成精美的正方形分享图片。
    *   **多平台兼容:** 优先尝试复制到剪贴板（现代浏览器），失败时自动降级到图片下载。
    *   **精美设计:** 分享图片包含所有玩家的武器分配、个人挑战、团队挑战（如有）以及生成时间，适合社交媒体分享。
    *   **状态反馈:** 分享过程中提供完整的loading状态和成功/失败提示。
*   **武器池同步:** 多人模式下的武器池选择区与单人模式完全同步。在任何一个模式下修改了武器池，都会立刻反映在另一个模式中。

### 3.4. 分享功能详细说明
为了让玩家能够轻松地与朋友分享他们的"命运安排"，我们提供了一套完整的分享解决方案：

#### 使用方法：
1. **完成分配:** 在多人模式下完成武器分配后，"📸 分享结果"按钮会自动显示。
2. **一键分享:** 点击分享按钮，系统会自动生成包含所有分配信息的精美图片。
3. **智能处理:** 
   - **现代浏览器:** 图片会自动复制到剪贴板，可直接粘贴到聊天软件或社交媒体。
   - **兼容模式:** 如果剪贴板不可用，图片会自动下载到本地。

#### 分享内容包含：
- 🎯 醒目的标题和时间戳
- 👥 所有玩家的武器分配（含武器图标和颜色）
- 🎯 每位玩家的个人挑战
- 📋 团队挑战（如果有）
- 🌐 项目标识和生成日期

#### 技术特性：
- **高质量输出:** 800x800像素的PNG格式，清晰度适合各种平台分享
- **移动端优化:** 响应式设计，支持手机和平板设备
- **跨浏览器兼容:** 支持Chrome、Firefox、Safari、Edge等主流浏览器
- **隐私安全:** 完全本地生成，不会上传任何数据到服务器

## 4. 技术架构 (Technical Architecture)

### 4.1. 文件结构

```
/
├── index.html              # 应用主页面，定义所有DOM结构
├── README.md               # 项目介绍文档
├── favicon.ico             # 网站图标
├── css/
│   └── main.css            # 全局样式表
└── js/
    ├── main.js             # 【核心】应用主脑：状态管理、渲染循环、事件绑定
    ├── data.js             # 静态数据：武器列表、挑战列表
    ├── wheel.js            # 封装单人模式的Canvas轮盘逻辑
    ├── ui.js               # 封装UI组件的生成与更新逻辑（如武器选择器）
    ├── sound.js            # 音效管理模块，动态加载Tone.js
    ├── share.js            # 【NEW】分享功能模块，独立的图片生成和分享逻辑
    └── utils.js            # 通用工具函数（目前主要是图片预加载器）
```

### 4.2. 核心思想：单一状态驱动 (Single Source of Truth)
本项目采用现代前端框架中流行的"单一状态驱动"模式来构建，这保证了代码的高度可维护性和可预测性。
*   **`appState` 对象:** 在 `main.js` 中，我们定义了一个名为 `appState` 的全局对象。这个对象是整个应用的"唯一数据源"，它包含了如"当前模式"、"激活的武器列表"、"多人玩家列表"等所有核心状态。
*   **`render()` 函数:** 同样在 `main.js` 中，我们有一个核心的 `render()` 函数。这个函数是**UI更新的唯一入口**。它的职责是读取 `appState` 的最新状态，然后将整个UI界面重新渲染成该有的样子。
*   **单向数据流:** 整个应用遵循一个清晰的单向数据流：
    `用户操作` -> `触发事件监听` -> `修改 appState` -> `调用 render()` -> `UI更新`
    这种模式避免了数据状态的混乱，让追踪Bug和添加新功能都变得非常简单。

### 4.3. 模块职责
*   **`main.js`:** 应用的"大脑"，负责：
    1.  定义和管理核心 `appState`。
    2.  实现 `render()` 渲染循环。
    3.  绑定所有DOM事件监听。
    4.  实现所有核心业务逻辑（如开始旋转、分配武器、添加玩家等）。
    5.  作为总指挥，调用其他模块提供的功能。
*   **`data.js`:** 应用的"数据库"，只负责存储静态数据，实现代码与数据的分离。
*   **`wheel.js`:** 一个独立的"轮盘"组件，封装了所有Canvas绘制和旋转动画的复杂逻辑。
*   **`ui.js`:** 一个"无状态"的UI模块，提供如 `setupSelector` 这样的函数，根据外部传入的数据来生成或更新一部分UI，但不维护自身状态。
*   **`sound.js`:** 独立的音效模块。它通过动态按需加载第三方音效库 `Tone.js` 来优化首屏加载速度，并通过提供虚拟对象来处理加载失败的容错，非常稳健。
*   **`share.js`:** 【NEW】独立的分享功能模块，包含两个核心类：
    1.  **`ShareImageGenerator`:** 负责使用Canvas API生成高质量的分享图片，支持武器图标预加载、文字排版、样式渲染等。
    2.  **`ShareController`:** 负责分享流程的控制，包括UI状态管理、剪贴板/下载策略选择、错误处理等。
    该模块采用完全独立的设计，不依赖其他业务逻辑，便于维护和测试。
*   **`utils.js`:** 通用工具箱，目前主要包含一个带进度回调的图片预加载器，用于优化武器图标的加载体验。

## 5. 未来展望 (Future Directions)

本项目仍有广阔的想象空间，以下是一些未来可能探索的方向：
*   **体验优化:** 加入设置记忆 (`localStorage`)、多种分享模板选择等功能。
*   **分享功能增强:** 支持自定义分享图片样式、添加水印或二维码、支持更多图片格式等。
*   **新功能模块:** 开发全新的"怪物轮盘"模式、"装备推荐"功能等。
*   **高级功能:** 增加"存档/预设"功能，允许玩家保存自己的常用配置，支持导入导出。
*   **社交功能:** 建立在线分享平台，支持分享链接、排行榜、成就系统等。

## 6. 技术亮点 (Technical Highlights)

### 6.1. 分享功能架构设计
本版本新增的分享功能采用了现代前端架构的最佳实践：

*   **模块化设计:** 完全独立的分享模块，零耦合度，易于维护和扩展。
*   **渐进增强:** 优雅降级策略，确保在不同浏览器环境下都能正常工作。
*   **错误边界:** 完整的错误处理机制，分享功能异常不会影响主要功能。
*   **性能优化:** 图标预加载、Canvas复用、内存管理等多重优化。

### 6.2. 跨平台兼容性
*   **桌面端:** 完整的剪贴板API支持，一键复制到剪贴板。
*   **移动端:** 响应式布局适配，触摸友好的交互设计。
*   **兼容性:** 自动检测浏览器能力，智能选择分享策略。

### 6.3. 用户体验优化
*   **视觉反馈:** 完整的loading状态、成功提示、错误处理。
*   **无障碍设计:** 语义化HTML、键盘导航支持、屏幕阅读器友好。
*   **性能表现:** 首屏加载优化、懒加载、资源压缩等。

## 7. 版本更新日志 (Changelog)

### v2.1 (2025-08-16) - 分享功能增强版
**🆕 新功能:**
- 新增一键分享功能，支持生成精美的正方形分享图片
- 智能分享策略：优先剪贴板复制，降级到本地下载
- 完整的分享状态反馈和错误处理机制
- 移动端分享功能适配和响应式优化

**🏗️ 架构优化:**
- 创建独立的 `share.js` 模块，完全解耦的分享功能
- 重构代码架构，保持 `main.js` 的纯净性
- 采用模块化设计，易于维护和扩展
- 完善的错误边界，分享功能异常不影响主功能

**🎨 UI/UX 改进:**
- 新增分享按钮，集成到多人模式控制面板
- 分享按钮loading状态和动画效果
- 移动端响应式布局优化
- 友好的成功/失败提示信息

**🔧 技术改进:**
- Canvas图片生成优化，支持高质量PNG输出
- 武器图标预加载和缓存机制
- 跨浏览器兼容性处理
- 内存管理和性能优化

### v2.0 (2025-08-09) - 多人模式重构版
**🆕 新功能:**
- 全新的多人模式（2-4人支持）
- 玩家昵称自定义
- 武器不重复分配算法
- 个人挑战和团队挑战系统
- "再Roll一次"功能

**🏗️ 架构升级:**
- 采用单一状态驱动（Single Source of Truth）架构
- 模块化代码重构
- 渐进式图片加载优化
- 音效系统完善

### v1.0 - 单人模式基础版
**🆕 核心功能:**
- 交互式武器轮盘
- 物理模拟旋转动画
- 武器自定义选择
- 进阶挑战系统
- 响应式设计

---

*本项目基于现代Web标准构建，注重性能、可访问性和用户体验。感谢所有测试者和贡献者的支持！*
